name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Create demo site
      run: |
        mkdir -p _site
        cat > _site/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Digital Psychological Intervention System - Production Demo</title>
            <meta name="description" content="Production-ready mental health platform with AI-powered features">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
              .banner { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; text-align: center; }
              .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }
              .section { background: white; margin: 2rem 0; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
              .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
              .card { background: #f8fafc; padding: 1.5rem; border-radius: 6px; border: 1px solid #e2e8f0; }
              .card h4 { color: #2563eb; margin-bottom: 0.5rem; }
              h1 { font-size: 2.5rem; margin-bottom: 1rem; }
              h2 { color: #2563eb; margin-bottom: 1rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
              .cta { display: inline-block; background: #2563eb; color: white; padding: 1rem 2rem; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 1rem 0; }
              .cta:hover { background: #1d4ed8; }
              ul { padding-left: 1.5rem; } li { margin-bottom: 0.5rem; }
              .code { background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 6px; font-family: monospace; overflow-x: auto; }
              .highlight { background: #dbeafe; padding: 0.2rem 0.4rem; border-radius: 3px; font-family: monospace; }
              .alert { background: #fee2e2; border: 1px solid #fca5a5; padding: 1rem; border-radius: 6px; margin: 1rem 0; }
              .footer { background: #f1f5f9; padding: 2rem; text-align: center; border-top: 1px solid #e2e8f0; margin-top: 3rem; }
              @media (max-width: 768px) { .container { padding: 1rem 0.5rem; } .section { padding: 1rem; } h1 { font-size: 1.8rem; } }
            </style>
        </head>
        <body>
            <div class="banner">
                <h1>üöÄ Digital Psychological Intervention System</h1>
                <p>Production-Ready Mental Health Support Platform</p>
            </div>
            
            <div class="container">
                <div class="section">
                    <h2>üéØ Complete Full-Stack Mental Health Platform</h2>
                    <p>A production-ready application designed to provide comprehensive mental health support with enterprise-grade security, accessibility, and therapeutic features.</p>
                    
                    <h3>‚ú® Core Features:</h3>
                    <ul>
                        <li><strong>ü§ñ AI First-Aid Chat</strong> - Deterministic trigger-based system with crisis detection</li>
                        <li><strong>üìä Validated Screenings</strong> - PHQ-9 and GAD-7 with clinical scoring</li>
                        <li><strong>üë• Confidential Booking</strong> - Anonymous counsellor sessions</li>
                        <li><strong>üìö Resource Hub</strong> - Multi-language educational content</li>
                        <li><strong>ü§ù Peer Support</strong> - Moderated community platform</li>
                        <li><strong>üëë Admin Panel</strong> - Analytics dashboard at <span class="highlight">/admin</span></li>
                    </ul>
                </div>
                
                <div class="section">
                    <h2>üèóÔ∏è Technical Architecture</h2>
                    <div class="grid">
                        <div class="card">
                            <h4>Frontend</h4>
                            <p>HTML5, CSS3, Vanilla JavaScript<br>WCAG Accessible, Responsive<br>English/Hindi Support</p>
                        </div>
                        <div class="card">
                            <h4>Backend</h4>
                            <p>Node.js + Express<br>RESTful API<br>JWT Authentication</p>
                        </div>
                        <div class="card">
                            <h4>Database</h4>
                            <p>Prisma ORM<br>SQLite/PostgreSQL<br>Migration System</p>
                        </div>
                        <div class="card">
                            <h4>Security</h4>
                            <p>CSRF Protection<br>Rate Limiting<br>Role-Based Access</p>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>üî• Key Implementation Highlights</h2>
                    
                    <h3>üß† Intelligent Chat System</h3>
                    <ul>
                        <li>Deterministic classification (anxiety, depression, stress, crisis)</li>
                        <li>Real-time crisis keyword detection with safety protocols</li>
                        <li>Integration with screening history for personalized responses</li>
                        <li>Session consent management with anonymization</li>
                    </ul>
                    
                    <h3>üìà Clinical Assessments</h3>
                    <ul>
                        <li><strong>PHQ-9:</strong> Depression screening (0-27 scale) with severity bands</li>
                        <li><strong>GAD-7:</strong> Anxiety screening (0-21 scale) with interpretation</li>
                        <li>Historical tracking and progress monitoring</li>
                        <li>Consent-based storage with privacy controls</li>
                    </ul>
                    
                    <h3>üõ°Ô∏è Enterprise Security</h3>
                    <ul>
                        <li>JWT authentication with refresh token rotation</li>
                        <li>CSRF protection via double-submit tokens</li>
                        <li>Role-based permissions (Student, Counsellor, Moderator, Admin)</li>
                        <li>Anonymous sessions for complete privacy</li>
                    </ul>
                </div>
                
                <div class="section">
                    <h2>üöÄ Production Ready</h2>
                    <p>Everything needed for deployment:</p>
                    <ul>
                        <li>‚úÖ Comprehensive test suite with Jest</li>
                        <li>‚úÖ CI/CD pipeline with GitHub Actions</li>
                        <li>‚úÖ Docker containerization</li>
                        <li>‚úÖ Database migrations and seeding</li>
                        <li>‚úÖ Environment configuration</li>
                        <li>‚úÖ Security hardening</li>
                        <li>‚úÖ Complete documentation</li>
                    </ul>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <a href="https://github.com/opsaan/digital-psychological-intervention-system" class="cta">
                            üìñ View Complete Source Code
                        </a>
                    </div>
                </div>
                
                <div class="section">
                    <h2>‚ö° Quick Start</h2>
                    <p>Get running locally in minutes:</p>
                    <div class="code">
git clone https://github.com/opsaan/digital-psychological-intervention-system.git<br>
cd digital-psychological-intervention-system<br>
npm install<br>
cp .env.example .env<br>
npm run prisma:generate<br>
npm run prisma:migrate<br>
npm run prisma:seed<br>
npm start
                    </div>
                    
                    <h3>üéØ Access Points:</h3>
                    <ul>
                        <li><strong>Application:</strong> <span class="highlight">http://localhost:8080</span></li>
                        <li><strong>Admin Panel:</strong> <span class="highlight">http://localhost:8080/admin</span></li>
                    </ul>
                    
                    <h3>üîë Default Credentials:</h3>
                    <ul>
                        <li><strong>Admin:</strong> <span class="highlight">admin@example.com</span> / <span class="highlight">Admin123!@#</span></li>
                        <li><strong>Demo User:</strong> <span class="highlight">demo@example.com</span> / <span class="highlight">Demo123!@#</span></li>
                    </ul>
                </div>
                
                <div class="section">
                    <h2>üö® Crisis Safety System</h2>
                    <ul>
                        <li>Real-time crisis keyword detection</li>
                        <li>Immediate safety resource display</li>
                        <li>Always-accessible help button</li>
                        <li>Emergency contact integration</li>
                        <li>Safety planning workflows</li>
                    </ul>
                    
                    <div class="alert">
                        <strong>‚ö†Ô∏è Safety Notice:</strong> This is a demonstration system. In emergencies:<br>
                        <strong>Emergency:</strong> 911 (US), 112 (EU) | <strong>Crisis Lifeline:</strong> 988 (US) | <strong>Text:</strong> HOME to 741741
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <h3>üè• Digital Psychological Intervention System</h3>
                <p>Production-ready mental health platform with comprehensive therapeutic features</p>
                <p style="margin-top: 1rem;">Built with ‚ù§Ô∏è for accessible mental health support</p>
                <p style="font-size: 0.9rem; color: #64748b; margin-top: 1rem;">
                    ¬© 2024 - Provides general support, not a substitute for professional medical care
                </p>
            </div>
        </body>
        </html>
        EOF
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: _site
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4